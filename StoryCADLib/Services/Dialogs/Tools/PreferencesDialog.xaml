<Page
    x:Class="StoryCAD.Services.Dialogs.Tools.PreferencesDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Main preferences content -->
<Pivot Name="PivotView" VerticalAlignment="Stretch" Grid.Row="0">

    <!-- General -->
    <PivotItem Header="General" VerticalContentAlignment="Stretch">
        <Grid HorizontalAlignment="Center">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <TextBox Grid.Row="0"
                     Header="Your first name:"
                     PlaceholderText="Put the first name want to publish under here"
                     Width="300" Margin="8"
                     Text="{x:Bind PreferencesVm.FirstName, Mode=TwoWay}"/>

            <TextBox Grid.Row="1"
                     Header="Your surname:"
                     PlaceholderText="Put the surname want to publish under here"
                     Width="300" Margin="8"
                     Text="{x:Bind PreferencesVm.LastName, Mode=TwoWay}"/>

            <TextBox Grid.Row="2"
                     Header="Your email:"
                     PlaceholderText="Put your email here"
                     Width="300" Margin="8"
                     Text="{x:Bind PreferencesVm.Email, Mode=TwoWay}"/>

            <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBox Name="ProjDirBox" IsReadOnly="True"
                         Header="Project directory:"
                         PlaceholderText="Where do you want to store your stories?"
                         Width="300" Margin="8"
                         Text="{x:Bind PreferencesVm.ProjectDirectory, Mode=OneWay}"/>
                <Button Content="Browse" Margin="0,25,10,0"
                        Click="SetProjectPath"/>
            </StackPanel>
        </Grid>
    </PivotItem>

    <!-- Backup -->
    <PivotItem Header="Backup" VerticalContentAlignment="Center">
        <Grid HorizontalAlignment="Center">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Orientation="Horizontal">
                <CheckBox Content="Automatically Save every"
                          IsChecked="{x:Bind PreferencesVm.AutoSave, Mode=TwoWay}"
                          Margin="4"/>
                <NumberBox Minimum="15" Maximum="60"
                           IsEnabled="{x:Bind PreferencesVm.AutoSave, Mode=TwoWay}"
                           PlaceholderText="Enter a value (Seconds)"
                           Margin="8"
                           Value="{x:Bind PreferencesVm.AutoSaveInterval, Mode=TwoWay}"/>
                <TextBlock Text="Seconds" VerticalAlignment="Center"/>
            </StackPanel>

            <CheckBox Grid.Row="1"
                      Content="Make a backup of the story when opened"
                      Margin="4"
                      IsChecked="{x:Bind PreferencesVm.BackupOnOpen, Mode=TwoWay}"/>

            <CheckBox Grid.Row="2"
                      Content="Make timed backups"
                      Margin="4"
                      IsChecked="{x:Bind PreferencesVm.TimedBackup, Mode=TwoWay}"/>

            <NumberBox Grid.Row="3"
                       Header="How often should backups be made? (Minutes)"
                       Minimum="1" Maximum="300"
                       Width="300" Margin="4"
                       Value="{x:Bind PreferencesVm.TimedBackupInterval, Mode=TwoWay}"/>

            <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
                <TextBox IsReadOnly="True" Width="300" Margin="8"
                         Header="Backup directory:"
                         PlaceholderText="Where do you want to store your backups?"
                         Text="{x:Bind PreferencesVm.BackupDirectory, Mode=TwoWay}"/>
                <Button Content="Browse" Margin="0,25,10,0"
                        Click="SetBackupPath"/>
            </StackPanel>
        </Grid>
    </PivotItem>

    <!-- Other -->
    <PivotItem Header="Other" VerticalContentAlignment="Stretch">
        <Grid HorizontalAlignment="Center">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <CheckBox Grid.Row="0" Grid.Column="0"
                      Content="Send error logs"
                      Margin="8"
                      HorizontalAlignment="Left"
                      IsChecked="{x:Bind PreferencesVm.ErrorCollectionConsent, Mode=TwoWay}"/>

            <CheckBox Grid.Row="0" Grid.Column="1"
                      Content="Send me StoryCAD newsletters"
                      Margin="8"
                      HorizontalAlignment="Left"
                      IsChecked="{x:Bind PreferencesVm.Newsletter, Mode=TwoWay}"/>

            <CheckBox Grid.Row="1" Grid.Column="0"
                      Content="Wrap node names"
                      Margin="8"
                      HorizontalAlignment="Left"
                      Click="ToggleWrapping"
                      Name="TextWrap"/>

            <CheckBox Grid.Row="1" Grid.Column="1"
                      Content="Advanced logging"
                      Margin="8"
                      HorizontalAlignment="Left"
                      IsChecked="{x:Bind PreferencesVm.AdvancedLogging, Mode=TwoWay}"/>

            <CheckBox Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                      Content="Show startup page"
                      Margin="8"
                      HorizontalAlignment="Center"
                      IsChecked="{x:Bind PreferencesVm.ShowStartupPage, Mode=TwoWay}"/>

            <ComboBox Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                      Width="300" Margin="8"
                      Header="Preferred Theme"
                      SelectedIndex="{x:Bind PreferencesVm.PreferredThemeIndex, Mode=TwoWay}">
                <ComboBoxItem Content="Use system theme"/>
                <ComboBoxItem Content="Light Theme"/>
                <ComboBoxItem Content="Dark Theme"/>
            </ComboBox>

            <ComboBox Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
                      Width="300" Margin="0,4,0,0"
                      Header="Preferred Search Engine"
                      Name="SearchEngine"
                      SelectedIndex="{x:Bind PreferencesVm.SearchEngineIndex, Mode=TwoWay}">
                <ComboBoxItem Content="DuckDuckGo"/>
                <ComboBoxItem Content="Google"/>
                <ComboBoxItem Content="Bing"/>
                <ComboBoxItem Content="Yahoo"/>
            </ComboBox>
        </Grid>
    </PivotItem>

    <!-- About -->
    <PivotItem Header="About" VerticalContentAlignment="Center">
        <Grid HorizontalAlignment="Center">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0"
                       Margin="5,0,0,20"
                       HorizontalAlignment="Center"
                       Text="{x:Bind State.Version}"/>

            <Button Grid.Row="1"
                    Content="Open Logs folder"
                    Width="200" Margin="20"
                    HorizontalAlignment="Center"
                    Click="OpenLogFolder"/>

            <HyperlinkButton Grid.Row="2"
                Content="StoryCAD was created by Terry Cox, Jake Shaw and Contributors"
                NavigateUri="https://github.com/StoryBuilder-org/StoryCAD/graphs/contributors"
                FontSize="13" Margin="5"
                HorizontalAlignment="Center"/>

            <HyperlinkButton Grid.Row="3"
                Content="Review StoryCAD on the Microsoft Store"
                Click="{x:Bind PreferencesVm.ShowRatingPrompt}"
                FontSize="13" Margin="5"
                HorizontalAlignment="Center"/>

            <TextBlock Grid.Row="4"
                       Text="Keep up with StoryCAD news:"
                       Margin="0,10"
                       HorizontalAlignment="Center"/>

            <StackPanel Grid.Row="5" Orientation="Horizontal" HorizontalAlignment="Center">
                <Button Width="50" Height="50" Margin="5"
                        Click="OpenURL" Tag="Discord">
                    <Image Source="/Assets/Icons/DiscordIcon.png"/>
                </Button>

                <Button Width="50" Height="50" Margin="5"
                        Click="OpenURL" Tag="FaceBook">
                    <Image Source="/Assets/Icons/FaceBookIcon.png"/>
                </Button>

                <Button Width="50" Height="50" Margin="5"
                        Click="OpenURL" Tag="Twitter">
                    <Image Source="/Assets/Icons/TwitterIcon.png"/>
                </Button>

                <Button Width="50" Height="50" Margin="5"
                        Click="OpenURL" Tag="Youtube">
                    <Image Source="/Assets/Icons/YoutubeIcon.png"/>
                </Button>

                <Button Width="50" Height="50" Margin="5"
                        Click="OpenURL" Tag="Mail">
                    <Image Source="/Assets/Icons/BootstrapEmailIcon.png"/>
                </Button>

                <Button Width="50" Height="50" Margin="5"
                        Click="OpenURL" Tag="Github">
                    <Image Source="/Assets/Icons/GithubIcon.png"/>
                </Button>

                <Button Width="50" Height="50" Margin="5"
                        Click="OpenURL" Tag="Website">
                    <Image Source="/Assets/Logo.png"/>
                </Button>
            </StackPanel>
        </Grid>
    </PivotItem>

    <!-- What's new -->
    <PivotItem Header="What's new">
        <Grid>
            <ScrollViewer VerticalScrollBarVisibility="Visible">
                <TextBlock Name="Changelog" TextWrapping="Wrap"/>
            </ScrollViewer>
        </Grid>
    </PivotItem>

    <!-- Dev -->
    <PivotItem Header="Dev" Name="Dev">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0">
                <Button Content="Set Init to false" Width="150" Margin="0,5"
                        Click="SetInitToFalse"/>
                <Button Content="Throw exception" Width="150" Margin="0,5"
                        Click="ThrowException"/>
                <Button Content="Attach Elmah" Width="150" Margin="0,5"
                        Click="{x:Bind Logger.AddElmahTarget}"/>
            </StackPanel>

            <ScrollViewer Grid.Column="1">
                <TextBlock Name="DevInfo" Margin="5,0"/>
            </ScrollViewer>
        </Grid>
    </PivotItem>

</Pivot>


        <!-- Error indicator -->
        <SymbolIcon Symbol="ReportHacked"
                    Foreground="Red"
                    Visibility="{x:Bind PreferencesVm.HasErrors, Mode=OneWay}"
                    HorizontalAlignment="Left" VerticalAlignment="Bottom"
                    Margin="0" Grid.Row="1">
            <ToolTipService.ToolTip>
                <TextBlock Text="{x:Bind PreferencesVm.Errors, Mode=OneWay}" MaxWidth="350"
                           Foreground="Red" />
            </ToolTipService.ToolTip>
        </SymbolIcon>

        <!-- Restart notice -->
        <TextBlock Text="Changing some preferences may require a restart to take effect."
                   HorizontalAlignment="Center" Margin="0,10,0,0" Grid.Row="2"/>
    </Grid>
</Page>
